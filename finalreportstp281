library(NHANES)
library(dplyr)
library(ggplot2)

# Data Preparation
df <- NHANES %>%
  select(Gender, Marijuana) %>%
  filter(!is.na(Gender), !is.na(Marijuana)) %>%
  mutate(
    Used_Marijuana = ifelse(Marijuana == "Yes", "Yes", "No")
  )

# Exploratory Data Analysis
table(df$Gender, df$Used_Marijuana)

ggplot(df, aes(x = Gender, fill = Used_Marijuana)) +
  geom_bar(position = "fill") +
  labs(
    title = "Proportion of Marijuana Use by Gender",
    x = "Gender",
    y = "Proportion"
  ) +
  scale_fill_brewer(palette = "Set1")

# Two-Proportion Z-Test
counts <- table(df$Gender, df$Used_Marijuana)

male_yes <- counts["male", "Yes"]
female_yes <- counts["female", "Yes"]

male_total <- sum(counts["male", ])
female_total <- sum(counts["female", ])

prop.test(
  x = c(male_yes, female_yes),
  n = c(male_total, female_total),
  alternative = "two.sided",
  correct = FALSE
)
